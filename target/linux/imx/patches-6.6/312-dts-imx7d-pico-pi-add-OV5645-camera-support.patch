From e27f93355164be4a637280966cc2de08c32e39ba Mon Sep 17 00:00:00 2001
From: Lech Perczak <lech.perczak@gmail.com>
Date: Wed, 11 May 2022 21:02:05 +0200
Subject: [PATCH] dts: imx7d-pico-pi: add OV5645 camera support

Signed-off-by: Lech Perczak <lech.perczak@gmail.com>
---
 arch/arm/boot/dts/nxp/imx/imx7d-pico-pi.dts | 58 +++++++++++++++++++++++++++++
 1 file changed, 58 insertions(+)

Index: linux-5.15.138/arch/arm/boot/dts/nxp/imx/imx7d-pico-pi.dts
===================================================================
--- linux-5.15.138.orig/arch/arm/boot/dts/nxp/imx/imx7d-pico-pi.dts
+++ linux-5.15.138/arch/arm/boot/dts/nxp/imx/imx7d-pico-pi.dts
@@ -71,6 +71,33 @@
 		touchscreen-size-x = <800>;
 		touchscreen-size-y = <480>;
 	};
+
+	ov5645_mipi: camera@3c {
+		compatible = "ovti,ov5645";
+		reg = <0x3c>;
+
+		pinctrl-names = "default";
+		pinctrl-0 = <&pinctrl_mipi_csi>;
+
+		clocks = <&clks IMX7D_CLKO1_ROOT_DIV>;
+		clock-names = "xclk";
+		clock-frequency = <24000000>;
+
+		enable-gpios = <&gpio1 4 GPIO_ACTIVE_HIGH>;
+		reset-gpios = <&gpio1 5 GPIO_ACTIVE_LOW>;
+
+		vdda-supply = <&reg_2p5v>;
+		vdddo-supply = <&reg_vref_1v8>;
+		vddd-supply = <&reg_vref_1v8>;
+
+		port {
+			ov5640_mipi_ep: endpoint {
+				remote-endpoint = <&mipi_sensor_ep>;
+				clock-lanes = <0>;
+				data-lanes = <1 2>;
+			};
+		};
+	};
 };
 
 &iomuxc {
@@ -101,5 +128,36 @@
 			MX7D_PAD_EPDC_DATA13__GPIO2_IO13	0x14
 		>;
 	};
+};
+
+&iomuxc_lpsr {
+	pinctrl_mipi_csi: mipicsigrp-1 {
+		fsl,pins = <
+			MX7D_PAD_LPSR_GPIO1_IO04__GPIO1_IO4	0x15
+			MX7D_PAD_LPSR_GPIO1_IO05__GPIO1_IO5	0x15
+			MX7D_PAD_LPSR_GPIO1_IO02__CCM_CLKO1	0x7d
+		>;
+	};
+};
+
+&csi {
+	status = "okay";
+};
+
+&mipi_csi {
+	clock-frequency = <24000000>;
+	status = "okay";
+
+	ports {
+		port@0 {
+			mipi_sensor_ep: endpoint1 {
+				remote-endpoint = <&ov5640_mipi_ep>;
+				data-lanes = <1 2>;
+			};
+		};
+	};
+};
 
+&video_mux {
+	status = "okay";
 };
